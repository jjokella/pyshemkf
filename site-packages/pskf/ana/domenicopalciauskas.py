# Domenico & Palciauskas (1973) solution for Head
import numpy as np


def head_top_boundary(x, A, B, L):
    """
    Compute head top boundary condition from Domenico (1978).

    Formula: A - B cos(pi x / L)

    Domenico, P. A., & Palciauskas, V. V., Theoretical analysis of forced
    convective heat transfer in regional ground-water flow,
    Geological Society of America Bulletin, 84(12), 3803 (1973).
    http://dx.doi.org/10.1130/0016-7606(1973)84<3803:taofch>2.0.co;2

    Parameters
    ----------
    x : Numpy array
        One dimensional array of x-coordinates.

    A : float
        Parameter in formula.

    B : float
        Parameter in formula.

    L : float
        Parameter in formula. Characteristic length
        in x-direction.

    Returns
    ----------
    h: Numpy array
        Top boundary condition
    """
    h = A - B * np.cos(np.pi * x / L)  # Top Boundary

    return h


def head(x, z, A, B, L, z0):
    """
    Compute head from Domenico (1978).

    Formula (9): A - B (cosh(pi z / L) / cosh(pi z0 / L)) cos(pi x / L)

    Domenico, P. A., & Palciauskas, V. V., Theoretical analysis of forced
    convective heat transfer in regional ground-water flow,
    Geological Society of America Bulletin, 84(12), 3803 (1973).
    http://dx.doi.org/10.1130/0016-7606(1973)84<3803:taofch>2.0.co;2

    Parameters
    ----------
    x : Numpy array
        Three dimensional array of x-coordinates.

    z : Numpy array
        Three dimensional array of z-coordinates.

    A : float
        Parameter in formula.

    B : float
        Parameter in formula.

    L : float
        Parameter in formula. Characteristic length
        in x-direction.

    z0 : float
        Parameter in formula. Characteristic length
        in z-direction.

    Returns
    ----------
    h: Numpy array
        3D array, head field.
    """
    head = A - B * (np.cosh(np.pi * z / L) / np.cosh(
        np.pi * z0 / L)) * np.cos(np.pi * x / L)

    return head


def temp(x, z, T1, qb, k, lam, rho, cp, mu, g, B, L, z0):
    """
    Compute temp from Domenico (1978).

    Formula (15).

    TODO: Write function for thermal diffusivity alpha as mixture of solid and
    fluid!

    Domenico, P. A., & Palciauskas, V. V., Theoretical analysis of forced
    convective heat transfer in regional ground-water flow,
    Geological Society of America Bulletin, 84(12), 3803 (1973).
    http://dx.doi.org/10.1130/0016-7606(1973)84<3803:taofch>2.0.co;2

    Parameters
    ----------
    x : Numpy array
        Three dimensional array of x-coordinates.

    z : Numpy array
        Three dimensional array of z-coordinates.

    qb : float
        base heat flow

    k : float
        permeability

    lam : float
        thermal conductivity, should probably be a mixture

    rho : float
        Fluid density

    cp : float
        specific heat capacity, should be the mixture, at the moment only water.
        volumetric

    mu : float
        fluid viscosity

    g : float
        gravitational acceleration

    B : float
        Parameter from head formula.

    L : float
        Parameter in formula. Characteristic length
        in x-direction.

    z0 : float
        Parameter in formula. Characteristic length
        in z-direction. Upper surface of flow.

    Returns
    ----------
    h: Numpy array
        3D array, head field.
    """

    # Temperature gradient
    dTdz = qb / lam

    # Hydraulic conductivity
    K = k * rho * g / mu

    # Thermal diffusivity
    alpha = lam / cp

    # Temperature
    T = (
        T1 +  # Constant background
        dTdz * (z0 - z) +  # Simple gradient
        (dTdz * K * B /
         (2.0 * alpha)) * np.cos(np.pi * x / L) / np.cosh(np.pi * z0 / L) * (
             (z0 - z) * np.cosh(np.pi * z / L) +  #
             L / (np.pi) * (np.sinh(np.pi *
                                    (z - z0) / L) / np.cosh(np.pi * z0 / L))))

    return T
